{% extends 'base.html' %}

{% block content %}
<div class="row">
        <div class="order">
            <hr>
            <h5>Тип парсинга: {{ order.data.parser.type }}. {{ order.data.parser.name }}</h5>
            <h5>Город: {{ order.data.data.city }}. Организация: {{ order.data.data.organisation }}</h5>
            <h5>Дата: {{ order.created_at.split("T")[0] }}</h5>
            {% if order.result %}
            <h6 class="text-success">Успешно!</h6>
            {% else %}
            <h6 class="text-warning">В процессе парсинга возникла ошибка!</h6>
            {% endif %}
            <div class="row">
                <div class="d-flex flex-row-reverse">
                    {% if order.result %}
                        <a class="btn btn-success m-1" href="/{{ order.result.html_filename }}" download>
                            Скачать файл
                        </a>
                    {% endif %}
                    <div class="m-1">
                        <form action="{{ url_for('parsers.delete_order', order_id=order.id) }}" method="post" onsubmit="return confirm('Are you want to delete this order?');">
                            <button type="submit" class="btn btn-danger">Удалить</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    <hr>
    <div class="results">
        <h4>Результаты</h4>
        {% for address, reviews in order.result.data.items() %}
            <div class="review mt-5">
                {% for review in reviews %}
                <div class="col-md-12 mb-3">
                    <h5 class="mt-3">
                        Адрес: {{ address }}
                    </h5>
                    <h5 class="mt-3">
                        Имя: {{ review.name }}
                    </h5>
                    <h5 class="mt-3">
                        Дата: {{ review.date }}
                    </h5>
                    <h5 class="mt-3">
                        Оценка: {{ review.grade }}
                    </h5>
                    <h5 class="mt-3">
                        Текст: {{ review.text_review }}
                    </h5>
                </div>
                <hr/>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>
{% endblock content %}